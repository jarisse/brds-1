/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version   1.7.0
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2014
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var t=function(t,i){return null===t||void 0===t||t==[]||""===t||i&&""===e.trim(t)},i=function(t,i){this.$element=e(t),this.init(i),this.listen()};i.prototype={constructor:i,init:function(t){var i=this;i.$container=e("#"+i.$element.attr("id")+"-cont"),i.$form=i.$container.find(".kv-editable-form"),i.$value=i.$container.find(".kv-editable-value"),i.$popover=i.$container.find(".kv-editable-popover"),i.$btnSubmit=i.$container.find("button.kv-editable-submit"),i.$btnReset=i.$container.find("button.kv-editable-reset"),i.$loading=i.$container.find(".kv-editable-loading"),i.$target=i.$container.find(t.target),i.valueIfNull=t.valueIfNull,i.placement=t.placement,i.displayValueConfig=t.displayValueConfig,i.showAjaxErrors=t.showAjaxErrors},refreshPosition:function(){var t,i=this,a=i.$popover,o=i.placement,r=i.$target,n=a[0].offsetWidth,l=a[0].offsetHeight,s=e.extend({},r.position(),{width:r[0].offsetWidth,height:r[0].offsetHeight});switch(o){case"bottom":t={top:s.top+s.height,left:s.left+s.width/2-n/2};break;case"top":t={top:s.top-l,left:s.left+s.width/2-n/2};break;case"left":t={top:s.top+s.height/2-l/2,left:s.left-n};break;case"right":t={top:s.top+s.height/2-l/2,left:s.left+s.width}}a.css(t)},listen:function(){var i,a=this,o=a.$form,r=a.$btnSubmit,n=a.$btnReset,l=o.parent(),s=a.$popover,d=a.$loading,c=a.$element,h=a.valueIfNull,f=c.closest(".field-"+c.attr("id")),u=c.closest(".kv-editable-parent"),v=f.find(".help-block"),p=a.displayValueConfig,m=o.find('input[name="hasEditable"]'),b=t(f.attr("class"))||t(v.attr("class"));i=function(i){var a=u.find(".kv-help-block");b?(t(a.attr("class"))&&(a=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(u)),a.html(i),u.addClass("has-error")):(f.addClass("has-error"),v.html(i),v.removeClass("kv-help-block").addClass("kv-help-block")),d.hide(),l.removeClass("kv-editable-processing")},o.on("submit",function(e){e.preventDefault()}),o.on("keyup",function(e){13==e.which&&r.trigger("click")}),o.on("reset",function(){setTimeout(function(){o.data("kvEditableSubmit",!1),b?(u.find(".help-block").remove(),u.removeClass("has-error")):(f.removeClass("has-error"),v.html(" ")),s.popoverX("refreshPosition")},200)}),o.find("input, select").on("change",function(){s.popoverX("refreshPosition"),c.trigger("editableChange",[c.val()])}),o.on("afterValidate",function(){}),n.on("click",function(){m.val(0),setTimeout(function(){o[0].reset()},200),c.trigger("editableReset")}),r.on("click",function(){l.addClass("kv-editable-processing"),d.show(),m.val(1),o.find("input, select").each(function(){var t=e(this);t.trigger("change")});var r="",n=a.$form.data("yiiActiveForm");e.ajax({type:o.attr("method"),url:o.attr("action"),data:o.serialize(),dataType:"json",error:function(e,t,o){a.showAjaxErrors&&i(o),c.trigger("editableAjaxError",[e,t,o])},success:function(m){var g=t(m.output)?c.val():m.output,k=u.find(".kv-help-block");return s.popoverX("refreshPosition"),t(m.message)?(t(k.attr("class"))||(f.removeClass("has-error"),k.html(""),k.hide(),v.html("")),o.find(".help-block").each(function(){return r=e(this).text(),t(r.trim())?void 0:void d.hide()}),t(r.trim())?(d.hide(),t(g)?g=h:void 0!==p[g]&&(g=p[g]),b?(u.find(".help-block").remove(),u.removeClass("has-error"),v.html(""),s.popoverX("hide"),a.$value.html(g)):(f.removeClass("has-error"),v.html(""),s.popoverX("hide"),a.$value.html(g),void 0!=n&&(o.yiiActiveForm("destroy"),o.yiiActiveForm(n.attributes,n.settings))),c.trigger("editableSuccess",[c.val()])):c.trigger("editableError",[c.val()]),void l.removeClass("kv-editable-processing")):(i(m.message),void c.trigger("editableError",[c.val()]))}}),c.trigger("editableSubmit",[c.val()])})}},e.fn.editable=function(t){var a=Array.apply(null,arguments);return a.shift(),this.each(function(){var o=e(this),r=o.data("editable"),n="object"==typeof t&&t;r||o.data("editable",r=new i(this,e.extend({},e.fn.editable.defaults,n,e(this).data()))),"string"==typeof t&&r[t].apply(r,a)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},showAjaxErrors:!0}}(window.jQuery);